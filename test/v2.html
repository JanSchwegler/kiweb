<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rotate Div Around Center</title>
<style>
  #rotate-div {
    width: 500px;
    height: 300px;
    background-color: blue;
    position: absolute;
    left: 50%;
    top: 50%;
    transform-origin: 50% 50%;
  }
</style>
</head>
<body>
<div id="rotate-div"></div>
<script>
  const rotateDiv = document.getElementById('rotate-div');
  let scrubbing = false;
  let initialScrubberAngle = 0; // angle of div / reset at audio change
  let initialMouseAngle = 0; // angle of div / reset at audio change
  let scrubbAngle = 0;

  let initialAngle = 0; // del?
  let currentAngle = 0; // del?
  let totalAngle = 0;

  rotateDiv.addEventListener('mousedown', (e) => {
    scrubbing = true;
    scrubbAngle = 0;
    // initialScrubberAngle
    let transform = window.getComputedStyle(rotateDiv).getPropertyValue('transform');
    let matrix = transform.match(/^matrix\((.+)\)$/);
    if (matrix) {
      let values = matrix[1].split(',');
      initialScrubberAngle = ((Math.atan2(values[1], values[0]) * 180 / Math.PI) + 360) % 360;
    }
    // initialMouseAngle
    let rect = rotateDiv.getBoundingClientRect();
    let centerX = rect.left + rect.width / 2;
    let centerY = rect.top + rect.height / 2;
    initialMouseAngle = ((Math.atan2(e.clientY - centerY, e.clientX - centerX) * 180 / Math.PI + 90) + 360) % 360;

    document.addEventListener('mousemove', rotate);
    document.addEventListener('mouseup', () => {
        document.removeEventListener('mousemove', rotate);
        scrubbing = false;
    });
  });

  function rotate(e) {
    let rect = rotateDiv.getBoundingClientRect();
    let centerX = rect.left + rect.width / 2;
    let centerY = rect.top + rect.height / 2;
    let mouseAngle = ((Math.atan2(e.clientY - centerY, e.clientX - centerX) * 180 / Math.PI + 90) + 360) % 360;

    scrubbAngle += mouseAngle - scrubbAngle;
    console.log(scrubbAngle - initialMouseAngle);

    let angle = mouseAngle;
    const angleChange = angle - initialAngle;
    currentAngle += angleChange;

    // Update total angle
    totalAngle += angleChange;

    // Limit counterclockwise rotation to starting point
    if (currentAngle < 0) {
      currentAngle = 0;
    }

    // Limit clockwise rotation to 5 times
    const maxRotations = 5 * (2 * Math.PI) * 360; // 5 times around (10*pi)
    if (currentAngle > maxRotations) {
      currentAngle = maxRotations;
    }

    rotateDiv.style.transform = `rotate(${totalAngle}deg)`;

    // Update initial angle for next movement
    initialAngle = angle;
  }
</script>
</body>
</html>
